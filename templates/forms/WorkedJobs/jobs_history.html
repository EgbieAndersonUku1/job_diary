{% extends 'secondary_base.html' %}

<div class="container">
    <a href="#" class="btn btn-info btn-lg">
        <span class="glyphicon glyphicon-user"></span>
            {{ session['username']}}
        </a>
</div>

{% block title %} Jobs history page {% endblock %}
{% block content %}
    <div style="overflow-x:auto;">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <ul class=flashes>
                    {% for message in messages %}
                        <li>{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}
    </div>

<table class="table table-striped">
      {% if not jobs %}
            <div id='error_msg'>
                <h5>This is not an error this page has loaded correct.</h5>
                    <src img='static/css/error.png' alt=''></src>
                        <div id='error_msg2'>
                            <h5>Your job history is totally empty!!<h5>
                        </div>
                    <img src="/static/fonts/empty.jpeg" class="img-circle" alt="Cinque Terre" width="210" height="236">
            </div>
        {% else %}
                <!--get the data from the job-->
            <h2>Days and times of jobs worked. </h2>
                <center>
                    <h6>The total pay you will earn over a period of {{ converter(total_hrs) }} is £{{ total_pay }}.</h6>
                </center>
                <tr>
                    <th>
                        Date
                    </th>
                    <th>
                        Day
                    </th>
                    <th>
                        Title
                    </th>
                    <th>
                        Role
                    </th>
                    <th>
                        Location
                    </th>
                    <th>
                        Hourly rate (£)
                    </th>
                    <th>
                        Start time
                    </th>
                    <th>
                        Finish time
                    </th>
                    <th>
                        Hours worked
                    </th>
                    <th>
                        Daily rate (£)
                    </th>
                        {% if session['username'] == 'admin' %}
                            <th>
                                Update/Delete
                            </th>
                        {% else %}
                            <th>
                                Job information
                            </th>
                        {% endif %}
                </tr>
                    {% for job in jobs %}
                        <tr>
                            <td>
                                {{ job.start_date.replace('-', '/') }}
                            </td>
                            <td>
                                {{ job.day[:3] }}
                            </td>
                            <td>
                                {{ job.job_title }}
                            </td>
                            <td>
                                {{ job.descr }}
                            </td>
                            <td>
                                {{ job.loc }}
                            </td>
                            <td>
                                £{{ job.hourly_rate}}
                            </td>
                            <td>
                                {{ job.start_time }}
                            </td>
                            <td>
                                {{ job.finish_time }}
                            </td>
                            <td>
                                {{ job.total_hours}}
                            </td>
                            <td>
                                £{{ job.daily_rate }}
                            </td>
                            <td>
                                {% if session['username'] == 'admin' %}
                                    <a href="{{ url_for('edit', value=job.row_id) }}">Edit</a> /
                                    <a href="{{ url_for('delete', row=job.row_id[1:]) }}">Delete</a>
                                {% else %}
                                    <!-- As a normal user, user can only edit jobs if their shift is not over-->
                                    {% if is_shift_over(jobs[0]) %}
                                        <a href="{{ url_for('info_page', row_id=job.row_id)}}">info</a>
                                    {% elif has_previous_job_been_worked(job, job.start_date, 'Yes') %}
                                        <a href="{{ url_for('info_page', row_id=job.row_id)}}">info</a>
                                    {% endif %}
                                {% endif %}
                            </td>
                    {% endfor %}
                {% endif %}
</table>
{% endblock %}
